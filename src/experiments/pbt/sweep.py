import os

num_ops_list = [1, 2, 4, 8, 16, 32, 64, 128]
envs = [("os_laser_tag_zs", 25), ("mpe_simple_push_comm_50", 2)]
num_seeds = 5
num_parallel = 5

counter = 0
for seed in range(num_seeds):
    for num_ops in num_ops_list:
        for env, timesteps_M in envs:
            for main in [0, 1]:
                num_workers = 16
                if num_ops < num_workers:
                    num_workers = num_ops
                timesteps = int(timesteps_M * 1_000_000)

                if counter == 4:
                    parallel = "&"
                    counter = 0
                else:
                    parallel = ""

                os.system(
                    "python -m aprl_defense.train "
                    '-f "gin/base.gin" '
                    "-p \"TrialSettings.mode='pbt'\" "
                    '-p "TrialSettings.wandb_group = mar-reproduce-report" '
                    f"-p \"RLSettings.env = '{env}'\" "
                    f'-p "RLSettings.max_timesteps = {timesteps}" '
                    f'-p "pbt.main_id = {main}" '
                    f'-p "pbt.num_ops = {num_ops}" '
                    f'-p "TrialSettings.checkpoint_freq_M = None" '
                    f'-p "TrialSettings.num_checkpoints = 10" '
                    f'-p "TrialSettings.num_workers = {num_workers}" '
                    f"{parallel}"
                )

                counter += 1

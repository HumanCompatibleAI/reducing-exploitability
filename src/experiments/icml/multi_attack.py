import os
import fire


def run_multi_atack(
    env_config: str,
    num_workers: int,
    sweep_name: str,
    victim_artifact: str,
    adversary_id: int,
    victim_policy_name: str,
    description: str = "",
    num_seeds: int = 3,
    parallel: bool = True,
):
    make_parallel = "&" if parallel else ""
    for i in range(num_seeds):
        command = (
            f"python -m aprl_defense.train "
            f'-f "gin/icml/attack/{env_config}" '
            f'-p "TrialSettings.num_workers = {num_workers}" '
            f"-p \"TrialSettings.wandb_group = '{sweep_name}'\" "
            f"-p \"TrialSettings.description = '{description}'\" "
            f"-p \"attack.victim_artifact = '{victim_artifact}'\" "
            f"-p \"attack.victim_policy_name = '{victim_policy_name}'\" "
            f'-p "attack.adversary_id = {adversary_id}" '
            f" {make_parallel} "
        )
        print(f"Starting {i} with command:")
        print(command)
        os.system(command)


if __name__ == "__main__":
    fire.Fire(run_multi_atack)

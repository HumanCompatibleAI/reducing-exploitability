import os
import fire
from typing import Optional, List, Tuple

from experiments.icml.multi_finetune import run_multi_finetune


def run_multi_finetune_sweep(
    env_config: str,
    num_workers: int,
    sweep_name: str,
    artifacts: List[Tuple[str]],
    description: str = "",
    num_seeds: int = 1,
    parallel: bool = True,
    override_config: bool = False,
    continue_agent_id: int = 0,
    victim_policy_name: Optional[str] = None,
    train_batch_size: Optional[int] = None,
    max_timesteps: Optional[int] = None,
):
    for continue_artifact, fixed_artifact in artifacts:
        run_multi_finetune(
            env_config=env_config,
            num_workers=num_workers,
            sweep_name=sweep_name,
            continue_artifact=continue_artifact,
            fixed_artifact=fixed_artifact,
            description=description,
            num_seeds=num_seeds,
            parallel=parallel,
            override_config=override_config,
            continue_id=continue_agent_id,
            victim_policy_name=victim_policy_name,
            train_batch_size=train_batch_size,
            max_timesteps=max_timesteps,
        )


if __name__ == "__main__":
    fire.Fire(run_multi_finetune_sweep)

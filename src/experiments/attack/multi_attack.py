import argparse
import os

parser = argparse.ArgumentParser("Sweep victim attack")
parser.add_argument('--option', choices=['a', 'b', 'c', 'd', 'e', 'all'], required=True)

args = parser.parse_args()

attacks_per_victim = 3

# env = "mpe_simple_push_comm_50"
env = 'os_laser_tag_zs'
# env = 'pz_rps'

project_name = 'laser-tag-pbrl'

max_timesteps = 10000000

policies = [
    # (0, 'policy_1'),
    (1, 'main'),
]

a = [  # laser tag
    'dhkp7m9n:v4', '2l9a5o3n:v4'
]
b = [
    '3ezzrn3e:v4', '9sbu90fe:v4'
]
c = [
    # '340p0irk:v9'
]
d = [
    # '3axqcihg:v9'
]
e = [
    # '3n2frc8k:v9'
]
parallel = ""
if args.option == 'a':  # simple push dim 25 normal self play
    victims = a
elif args.option == 'b':
    victims = b
elif args.option == 'c':
    victims = c
elif args.option == 'd':
    victims = d
elif args.option == 'e':
    victims = e
elif args.option == 'all':
    victims = a + b + c + d + e
    parallel = '&'
else:
    raise NotImplementedError()

for i in range(attacks_per_victim):
    for (adv_id, victim_policy) in policies:
        for victim in victims:
            os.system(
                f"python -m aprl_defense.train --out-path /scratch/pavel/out/  --wandb-group {project_name} --alg ppo --mode finetune --adv-id {adv_id} --victim-policy-name {victim_policy}" +
                f' --max-timesteps {max_timesteps} --num-workers 10'
                f' --victim-artifact {victim} --description "75-op-sanity" --env {env}'
                ' --override "{\\"framework\\":\\"tf\\"}"'
                f' {parallel} '
            )
